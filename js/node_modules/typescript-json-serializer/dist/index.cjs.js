"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib");require("reflect-metadata");var r,t="api:map:";!function(e){e.Array="array",e.Boolean="boolean",e.Date="date",e.Number="number",e.Object="object",e.String="string"}(r||(r={}));var a=function(r){var t=Reflect.getPrototypeOf(r);return t&&t.name?e.__spreadArray(e.__spreadArray([],a(t)),[t.name]):[]},n=function(e,r){return e.map((function(e){return Reflect.getMetadata(""+t+e,r)}))},i=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var a={};return r.forEach((function(r){r&&Object.keys(r).forEach((function(t){a[t]=e.__assign(e.__assign({},a[t]),r[t])}))})),a},o=function(a,o){var s;if([null,void 0].includes(a))return a;if(void 0===o)return p(typeof a,a);typeof a===r.String&&(a=JSON.parse(a));var c=new o,u=c.constructor.name,l=null!==(s=Reflect.getMetadata("api:map:serializable",o))&&void 0!==s?s:{},d=l.baseClassNames,v=l.options,y=""+t+u,m=Reflect.hasMetadata(y,c),g={};if(!(m||d&&d.length))return c;if(g=Reflect.getMetadata(y,c),d&&d.length){var b=n(d,c);g=i.apply(void 0,e.__spreadArray(e.__spreadArray([],b),[g]))}return Object.keys(g).forEach((function(e){var r=f(c,e,g[e],a,null==v?void 0:v.formatPropertyNames);if(null==r&&g[e].required)throw new Error("Property '"+e+"' is required in "+u+" "+JSON.stringify(a)+".");void 0!==r&&(c[e]=r)})),c},s=function(a,o){var s;if(void 0===o&&(o=!0),[void 0,null].includes(a)||typeof a!==r.Object)return a;var f=a.constructor.name,u=""+t+f,l=null!==(s=Reflect.getMetadata("api:map:serializable",a.constructor))&&void 0!==s?s:{},p=l.baseClassNames,d=l.options,v=p&&p.length,y=Reflect.hasMetadata(u,a),m={};if(!y&&!v)return a;if(m=Reflect.getMetadata(u,a),v){var g=n(p,a);m=i.apply(void 0,e.__spreadArray(e.__spreadArray([],g),[m]))}var b={},O=Object.keys(a);return Object.keys(m).forEach((function(e){if(O.includes(e)){var r=m[e],t=r.beforeSerialize,n=r.afterSerialize,i=void 0;t&&(i=a[e],a[e]=t(a[e],a));var s=c(a,e,r,o);if(n&&(s=n(s,a)),a[e]=i||a[e],r.names)r.names.forEach((function(e){(!o||o&&void 0!==s[e])&&(b[e]=s[e])}));else if(!o||o&&void 0!==s)if(!r.isNameOverridden&&(null==d?void 0:d.formatPropertyNames)){var f=d.formatPropertyNames(r.name);b[f]=s}else b[r.name]=s}})),b},c=function(e,t,a,n){var i=e[t],o=Reflect.getMetadata("design:type",e,t),c=!!o.name&&o.name.toLocaleLowerCase()===r.Array,f=a.predicate,l=a.type||o,p=u(l);if(i&&(p||f)){if(c)return i.map((function(e){return s(e,n)}));if(a.isDictionary){var d={};return Object.keys(i).forEach((function(e){d[e]=s(i[e],n)})),d}return s(i,n)}return l.name.toLocaleLowerCase()===r.Date&&typeof i===r.Object?i.toISOString():i},f=function(e,t,a,n,i){var s;if([null,void 0].includes(n))return n;if("names"in a){var c={};a.names.forEach((function(e){return c[e]=n[e]})),s=c}else if("name"in a&&!a.isNameOverridden&&i){var f=i(a.name);s=n[f]}else s=n[a.name];if([null,void 0].includes(s))return s;var l,d=Reflect.getMetadata("design:type",e,t),v=!!d.name&&d.name.toLowerCase()===r.Array,y=a.isDictionary,m=a.predicate,g=a.beforeDeserialize,b=a.afterDeserialize,O=a.type||d,h=u(O);if(g&&(s=g(s,e)),y){var N={};typeof s!==r.Object?(console.error("Type '"+typeof s+"' is not assignable to type 'Dictionary' for property '"+t+"' in '"+e.constructor.name+"'.\n","Received: "+JSON.stringify(s)),l=void 0):(Object.keys(s).forEach((function(r){h||m?(m&&(O=m(s[r],s)),N[r]=o(s[r],O)):N[r]=p(typeof s[r],s[r],t,e.constructor.name)})),l=N)}else if(v){var S=[];Array.isArray(s)?(s.forEach((function(r){h||m?(m&&(O=m(r,s)),S.push(o(r,O))):S.push(p(typeof r,r,t,e.constructor.name))})),l=S):(console.error("Type '"+typeof s+"' is not assignable to type 'Array' for property '"+t+"' in '"+e.constructor.name+"'.\n","Received: "+JSON.stringify(s)),l=void 0)}else h||m?(O=m?m(s,n):O,l=o(s,O)):l=p(O.name,s,t,e.constructor.name);return b&&(l=b(l,e)),l},u=function(e){return Reflect.hasOwnMetadata("api:map:serializable",e)},l=function(e,t){if(!t)return{name:e.toString(),isNameOverridden:!1};var a;a=typeof t===r.String?{name:t,isNameOverridden:!0}:t.name?{name:t.name,isNameOverridden:!0}:t.names&&t.names.length?{names:t.names}:{name:e.toString(),isNameOverridden:!1};return["isDictionary","required","beforeSerialize","afterSerialize","beforeDeserialize","afterDeserialize"].forEach((function(e){void 0!==t[e]&&null!==t[e]&&(a[e]=t[e])})),t.predicate?a.predicate=t.predicate:t.type&&(a.type=t.type),a},p=function(e,t,a,n){if(null==e)return t;if(e=e.toLowerCase(),(typeof t).toLowerCase()===e)return t;var i=function(){console.error("Type '"+typeof t+"' is not assignable to type '"+e+"' for property '"+a+"' in '"+n+"'.\n","Received: "+JSON.stringify(t))};switch(e){case r.String:var o=t.toString();return"[object Object]"===o?void i():o;case r.Number:var s=+t;return isNaN(s)?void i():s;case r.Boolean:return void i();case r.Date:return isNaN(Date.parse(t))?void i():new Date(t);default:return t}};exports.JsonProperty=function(e){return function(r,a,n){if(void 0===a&&r.prototype){var i=Reflect.getMetadata("design:paramtypes",r)[n];a=function(e){var r=e.toString().split("}")[0].replace(/(\/\*[\s\S]*?\*\/|\/\/.*$)/gm,"").replace(/[\r\t\n\v\f ]/g,""),t=/(?:this\.)([^,;\n}]+)/gm,a=new Map,n=/(?:.*(?:constructor|function).*?(?=\())(?:\()(.+?(?=\)))/m.exec(r);if(!n||!n.length)return a;for(var i,o=n[1].split(","),s=function(){var e=i[1].split("="),r=o.findIndex((function(r){return r===e[1]}));r>-1&&a.set(r,e[0])};i=t.exec(r);)s();return a}(r.prototype.constructor).get(n),r=r.prototype,Reflect.defineMetadata("design:type",i,r,a)}var o={},s=r.constructor.name,c=""+t+s;Reflect.hasMetadata(c,r)&&(o=Reflect.getMetadata(c,r)),o[a]=l(a,e),Reflect.defineMetadata(c,o,r)}},exports.Serializable=function(e){return function(r){var t=a(r);Reflect.defineMetadata("api:map:serializable",{baseClassNames:t,options:e},r)}},exports.deserialize=o,exports.serialize=s;
